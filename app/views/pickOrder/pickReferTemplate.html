<div class="modal-pick-refer">
    <div class="modal-header">
        <button ng-if="referOpenMode==REFER_OPEN_MODE.auto" type="button" class="close" ng-click="goBack()">返回</button>
        <button ng-if="referOpenMode==REFER_OPEN_MODE.manual" type="button" class="close" ng-click="cancel()"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">拣货信息参考</h4>
    </div>
    <div class="modal-body form-inline container">
        <div class="header-wrap">
            <company-searcher ng-if="orderId==0&&goodsChooseOrderId==0" select-company="selectCompanyCallback(company)"></company-searcher>
            <span ng-if="orderId>0||goodsChooseOrderId>0">{{pickOrder.companyName}}</span>
            <drop-down ng-if="!shelfSelectDisable" default-item={{shelfConfig.getDefaultItem(pickOrder.shelfId)}} list={{shelfConfig.list}} desc-field="shelfName" select="shelfConfig.selectItem(item)" btn-style="btn-default"></drop-down>
            <span ng-if="shelfSelectDisable">{{pickOrder.shelfName}}</span>
            <span>拣货类型:{{company.pickingType==CONSTANTS.PICKING_TYPE.OTHER?company.pickingRemark:CONSTANTS.PICKING_TYPE.DESC[company.pickingType]}}</span>
            <div class="operate-buttons">
                <button class="btn btn-warning btn-pull-sale" ng-disabled="disableEdit||!hasReferData" ng-click="autoAdd()">自动添加</button>
            </div>
        </div>
        <div>
            <div class="title">
                <img src="{{PICK_PRODUCT_REASON.ICON[PICK_PRODUCT_REASON.WISHLIST]}}" /> 心愿单
                <button class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit||!hasReferData" ng-click="addSuiteToPickOrder(suite)">将本套餐加入货架</button>
            </div>
            <table ng-table class="table table-condensed table-bordered table-hover ngtable">
                <tr ng-repeat="item in referData.wishlist">
                    <td data-title="'商品名称'">{{item.product.header.productName}}</td>
                    <td data-title="'心愿套餐'"><img src="./img/icon-like.png" />{{item.suite.title}}</td>
                    <td data-title="'最近60日销量'">{{item.saleCount_60}}</td>
                    <td data-title="'最近60日复购率'">{{reserveNum(item.rebuyRate_60)+'%'}}</td>
                    <td data-title="'最近60日货架单品产出值'">{{reserveNum(item.salesRate_60)+'%'}}</td>
                    <td data-title="'其他推荐原因'"><img ng-repeat="reason in item.otherReasons" src="{{PICK_PRODUCT_REASON.ICON[reason]}}" /></td>
                    <td class="td-operate" data-title="'操作'">
                        <button ng-if="!item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="addToPickOrder(item)">加入拣货单</button>
                        <button ng-if="item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="removeFromPickOrder(item)">移除</button>
                    </td>
                </tr>
            </table>
        </div>
        <div>
            <div class="title">
                <img src="{{PICK_PRODUCT_REASON.ICON[PICK_PRODUCT_REASON.REPLACEMENT_ADVICE]}}" /> 本期下架商品同品类替换推荐
            </div>
            <table ng-table class="table table-condensed table-bordered table-hover ngtable">
                <tr ng-repeat="item in referData.replacements">
                    <td data-title="'商品名称'">{{item.product.header.productName}}</td>
                    <td data-title="'被替换商品'">{{item.productToReplace.header.productName}}</td>
                    <td data-title="'替换原因(全局)'">{{item.rank}}</td>
                    <td data-title="'所属品类'">{{item.product.category.categoryName}}</td>
                    <td data-title="'最近60日销量'">{{item.saleCount_60}}</td>
                    <td data-title="'最近60日复购率'">{{reserveNum(item.rebuyRate_60)+'%'}}</td>
                    <td data-title="'最近60日货架单品产出值'">{{reserveNum(item.salesRate_60)+'%'}}</td>
                    <td data-title="'其他推荐原因'"><img ng-repeat="reason in item.otherReasons" src="{{PICK_PRODUCT_REASON.ICON[reason]}}" /></td>
                    <td class="td-operate" data-title="'操作'">
                        <button ng-if="!item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="addToPickOrder(item)">加入拣货单</button>
                        <button ng-if="item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="removeFromPickOrder(item)">移除</button>
                    </td>
                </tr>
            </table>
        </div>
        <div>
            <div class="title">
                <img src="{{PICK_PRODUCT_REASON.ICON[PICK_PRODUCT_REASON.SHELF_BEST_SALES]}}" /> 货架TOP榜
            </div>
            <table ng-table class="table table-condensed table-bordered table-hover ngtable">
                <tr ng-repeat="item in referData.shelfSalesChart">
                    <td data-title="'top榜'">{{'TOP'+($index+1)}}</td>
                    <td data-title="'商品名称'">{{item.product.header.productName}}</td>
                    <td data-title="'本期货架出库率'">{{reserveNum(item.shipmentRateN)+'%'}}</td>
                    <td data-title="'本期货架销售额(元)'">{{item.salesFeeN/100.0}}</td>
                    <td data-title="'所属品类'">{{item.product.category.categoryName}}</td>
                    <td data-title="'最近60日销量'">{{item.saleCount_60}}</td>
                    <td data-title="'最近60日复购率'">{{reserveNum(item.rebuyRate_60)+'%'}}</td>
                    <td data-title="'最近60日货架单品产出值'">{{reserveNum(item.salesRate_60)+'%'}}</td>
                    <td data-title="'其他推荐原因'"><img ng-repeat="reason in item.otherReasons" src="{{PICK_PRODUCT_REASON.ICON[reason]}}" /></td>
                    <td class="td-operate" data-title="'操作'">
                        <button ng-if="!item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="addToPickOrder(item)">加入拣货单</button>
                        <button ng-if="item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="removeFromPickOrder(item)">移除</button>
                    </td>
                </tr>
            </table>
        </div>
        <div>
            <div class="title">
                <img src="{{PICK_PRODUCT_REASON.ICON[PICK_PRODUCT_REASON.GLOBAL_BEST_SALES]}}" /> 全库TOP榜
            </div>
            <table ng-table class="table table-condensed table-bordered table-hover ngtable">
                <tr ng-repeat="item in referData.globalSalesChart">
                    <td data-title="'top榜'">{{'TOP'+($index+1)}}</td>
                    <td data-title="'商品名称'">{{item.product.header.productName}}</td>
                    <td data-title="'最近60日出货率'">{{reserveNum(item.shipmentRate_60)+'%'}}</td>
                    <td data-title="'最近60日销售额(元)'">{{item.salesFee_60/100.0}}</td>
                    <td data-title="'所属品类'">{{item.product.category.categoryName}}</td>
                    <td data-title="'最近60日销量'">{{item.saleCount_60}}</td>
                    <td data-title="'最近60日复购率'">{{reserveNum(item.rebuyRate_60)+'%'}}</td>
                    <td data-title="'最近60日货架单品产出值'">{{reserveNum(item.salesRate_60)+'%'}}</td>
                    <td data-title="'其他推荐原因'"><img ng-repeat="reason in item.otherReasons" src="{{PICK_PRODUCT_REASON.ICON[reason]}}" /></td>
                    <td class="td-operate" data-title="'操作'">
                        <button ng-if="!item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="addToPickOrder(item)">加入拣货单</button>
                        <button ng-if="item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="removeFromPickOrder(item)">移除</button>
                    </td>
                </tr>
            </table>
        </div>
        <div>
            <div class="title">
                <img src="{{PICK_PRODUCT_REASON.ICON[PICK_PRODUCT_REASON.RECOMMENDED]}}" /> 单品推荐
            </div>
            <table ng-table class="table table-condensed table-bordered table-hover ngtable">
                <tr ng-repeat="item in referData.recommended">
                    <td data-title="'商品名称'">{{item.product.header.productName}}</td>
                    <td data-title="'最近60日销量'">{{item.saleCount_60}}</td>
                    <td data-title="'最近60日复购率'">{{reserveNum(item.rebuyRate_60)+'%'}}</td>
                    <td data-title="'最近60日货架单品产出值'">{{reserveNum(item.salesRate_60)+'%'}}</td>
                    <td data-title="'其他推荐原因'"><img ng-repeat="reason in item.otherReasons" src="{{PICK_PRODUCT_REASON.ICON[reason]}}" /></td>
                    <td class="td-operate" data-title="'操作'">
                        <button ng-if="!item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="addToPickOrder(item)">加入拣货单</button>
                        <button ng-if="item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="removeFromPickOrder(item)">移除</button>
                    </td>
                </tr>
            </table>
        </div>
        <div>
            <div class="title">
                <img src="{{PICK_PRODUCT_REASON.ICON[PICK_PRODUCT_REASON.SUPPLEMENT_ADVICE]}}" /> 建议补货商品
            </div>
            <table ng-table class="table table-condensed table-bordered table-hover ngtable">
                <tr ng-repeat="item in referData.replenishment">
                    <td data-title="'商品名称'">{{item.productDetail.header.productName}}</td>
                    <td data-title="'top榜'">{{item.rank}}</td>
                    <td data-title="'本期货架出货率'">{{reserveNum(item.shipmentRateN)+'%'}}</td>
                    <td data-title="'最近60日该货架补货次数'">{{item.supplementTimes_60}}</td>
                    <td data-title="'最近5日该货架日均销量'">{{item.last_5_SalesCountAvg}}</td>
                    <td data-title="'货架库存'">{{item.stock}}</td>
                    <td data-title="'盒规数'">--</td>
                    <td data-title="'建议补货数'">{{item.recommSupplementCount}}</td>
                    <td data-title="'其他补货原因'"><img ng-repeat="reason in item.otherReasons" src="{{PICK_PRODUCT_REASON.ICON[reason]}}" /></td>
                    <td class="td-operate" data-title="'操作'">
                        <button ng-if="!item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="addToPickOrder(item)">加入补货列表</button>
                        <button ng-if="item.tmpSelect" class="btn btn-default btn-sm btn-add" ng-disabled="disableEdit" ng-click="removeFromPickOrder(item)">移除</button>
                    </td>
                </tr>
            </table>
        </div>
        <div class="row">
            <div class="col-md-6 title">
                本期零动销
                <table ng-table class="table table-condensed table-bordered table-hover ngtable">
                    <tr ng-repeat="item in referData.zeroShipmentRate">
                        <td data-title="'序号'">{{$index+1}}</td>
                        <td data-title="'商品名称'">{{item.product.header.productName}}</td>
                        <td data-title="'本期货架出货率'">{{reserveNum(item.shipmentRateN)+'%'}}</td>
                    </tr>
                </table>
            </div>
            <div class="col-md-6">
                本期出货率最低TOP5
                <table ng-table class="table table-condensed table-bordered table-hover ngtable">
                    <tr ng-repeat="item in referData.lowShipmentRate">
                        <td data-title="'序号'">{{$index+1}}</td>
                        <td data-title="'商品名称'">{{item.product.header.productName}}</td>
                        <td data-title="'本期货架出货率'">{{reserveNum(item.shipmentRateN)+'%'}}</td>
                    </tr>
                </table>
            </div>
        </div>
        <div>
            企业备注栏
            <textarea class="form-control textarea-company-desc" ng-model="company.des"></textarea>
            <button type="button" class="btn btn-primary btn-save-company" ng-click="modifyCompanyDes(company)">确认修改备注</button>
        </div>
        <div style="margin-top:16px;">
            <h5>名词解释</h5>
            <h5>1 复购率=（订单量-购买人数）/购买人数</h5>
            <h5>2 货架单品产出值=单品销量/单品铺货货架数</h5>
            <h5>3 出货率=售出商品数/送货商品数*100%</h5>
        </div>
    </div>
    <div class="modal-footer">
        <button ng-if="referOpenMode==REFER_OPEN_MODE.auto" type="button" class="btn btn-default" ng-click="goBack()">返回</button>
        <button ng-if="referOpenMode==REFER_OPEN_MODE.manual" type="button" class="btn btn-default" ng-click="cancel()">取消</button>
        <button type="button" class="btn btn-warning" ng-disabled="disableEdit||!hasReferData" ng-click="autoAdd()">自动添加</button>
        <button type="button" class="btn btn-primary" ng-disabled="disableEdit||!hasReferData" ng-click="finish()">完成</button>
    </div>
    <div class="mark" ng-show="hasReferData==false">
        <img src='./img/loading.gif' />
    </div>
</div>